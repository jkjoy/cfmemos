# ========================================
# Cloudflare-Memos 后端 API 服务配置
# ========================================

name = "memos-api"
main = "src/index.js"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

# 配置文件导入规则
[[rules]]
type = "Data"
globs = ["**/*.ico"]
fallthrough = true

# ========================================
# 环境变量配置
# ========================================
[vars]
# Gravatar CDN 代理配置（支持国内访问）
GRAVATAR_CDN = "https://gravatar.loli.net"

# CORS 允许的前端域名（逗号分隔）
# 本地开发已默认包含 localhost:5173 和 localhost:3000
# 这里添加生产环境的前端域名
ALLOWED_ORIGINS = ""

# 时区配置（IANA 时区数据库格式）
# 示例: "Asia/Shanghai", "America/New_York", "Europe/London"
# 留空则使用 UTC
TIMEZONE = "Asia/Shanghai"

# ========================================
# 生产环境配置
# ========================================
[env.production.vars]
ENVIRONMENT = "production"
# 生产环境的前端域名，部署后需要更新
# ALLOWED_ORIGINS = "https://your-frontend.pages.dev,https://your-domain.com"

# ========================================
# 数据库配置
# ========================================
[[d1_databases]]
binding = "DB"
database_name = "memos_db"
database_id = "437a3815-ae40-4337-83f7-fde6f2487718"

# ========================================
# 对象存储配置
# ========================================
[[r2_buckets]]
binding = "BUCKET"
bucket_name = "memos"